function PPUpdateObject(){this.payoutPercentList=[]}
PPUpdateObject.prototype.getForm=function(){var a='<table id="rep-structure-update-table"><tr>';if(this.payoutPercentList.length>0)for(var b=0;b<this.payoutPercentList.length;b++)a+="<td>"+$("select[name=brokerNumber] option:selected").text()+"</td>",a+='<td>commission &lt; <input type="text" name="minAmt" value="'+this.payoutPercentList[b].minAmt+'" size=8 /></td>',a+='<td> AND &gt; <input type="text" name="maxAmt" value="'+this.payoutPercentList[b].maxAmt+'" size=8 /></td>',a+='<td>payout is: <input type="text" name="payPercent" value="'+
this.payoutPercentList[b].payPercent*100+'" size=4 />%</td>',a+='<td><button name="rep-structure-update-payout" value="'+b+'">^</button></td>',a+='<td><button name="rep-structure-delete-payout" value="'+b+'">-</button></td>',b==this.payoutPercentList.length-1&&this.payoutPercentList[b].id!=null&&(a+='<td><button name="rep-structure-add-payout" value="'+b+'">+</button></td>'),a+="</tr>";else this.payoutPercentList.push({id:null,repNum:"",minAmt:"",maxAmt:"",payPercent:""}),a+="<td>"+$("select[name=brokerNumber] option:selected").text()+
"</td>",a+='<td>commission &lt; <input type="text" name="minAmt" value="'+this.payoutPercentList[0].minAmt+'" size=8 /></td>',a+='<td> AND &gt; <input type="text" name="maxAmt" value="'+this.payoutPercentList[0].maxAmt+'" size=8 /></td>',a+='<td>payout is: <input type="text" name="payPercent" value="'+this.payoutPercentList[0].payPercent*100+'" size=4 />%</td>',a+='<td><button name="rep-structure-update-payout" value="0">^</button></td></tr>';a+="</table>";return a};
PPUpdateObject.prototype.setPayoutPercentList=function(){var a=this;dbw.table="payoutStructure";dbw.getByFields({repNum:$("select[name=brokerNumber]").val()},function(b){a.payoutPercentList=b})};PPUpdateObject.prototype.isValidPercent=function(a){return isNaN(parseFloat(a))};PPUpdateObject.prototype.simpleModalObject=function(a,b){return $("<div></div>").dialog({autoOpen:!1,buttons:{Ok:function(){$(this).dialog("close");b!=null&&b()}},height:"auto",modal:!0,title:a,width:"auto"})};
$(document).ready(function(){dbw=new DbWrapper;var a=new PPUpdateObject,b=$("<div></div>").dialog({autoOpen:!1,buttons:{Ok:function(){$(this).dialog("close");location.reload(!0)}},height:"auto",modal:!0,title:"Update Broker Structure",width:"auto"});$("#rep-structure-new-payout").live("click",function(){a.method="insert";a.setPayoutPercentList();b.html(a.getForm());b.dialog("open");return!1});$("#rep-structure-edit-payout").live("click",function(){a.method="update";a.setPayoutPercentList();b.html(a.getForm());
b.dialog("open");return!1});$("button[name=rep-structure-update-payout]").live("click",function(){var c=$(this).val(),d={};d.repNum=$("select[name=brokerNumber]").val();d.minAmt=$("#rep-structure-update-table tr").find("input[name=minAmt]").get(c).value;d.maxAmt=$("#rep-structure-update-table tr").find("input[name=maxAmt]").get(c).value;d.payPercent=$("#rep-structure-update-table tr").find("input[name=payPercent]").get(c).value/100;if(a.isValidPercent(d.payPercent))return c=a.simpleModalObject("Submission Error",
null),c.html("Please enter a valid percent."),c.dialog("open"),!1;console.dir(d);a.payoutPercentList[c].id!=null?(d.id=a.payoutPercentList[c].id,dbw.table="payoutStructure",dbw.updateObject(d,function(a){console.dir(a)})):(dbw.table="payoutStructure",dbw.insertObject(d,function(a){console.dir(a)}));a.setPayoutPercentList();b.html(a.getForm());b.dialog("open");return!1});$("button[name=rep-structure-delete-payout]").live("click",function(){var c=$(this).val();if(a.payoutPercentList[c].id!=null)return dbw.table=
"payoutStructure",dbw.deleteObject(a.payoutPercentList[c].id,function(a){console.dir(a)}),a.setPayoutPercentList(),b.html(a.getForm()),b.dialog("open"),!1});$("button[name=rep-structure-add-payout]").live("click",function(){$(this).val();a.payoutPercentList.push({id:null,repNum:"",minAmt:"",maxAmt:"",payPercent:""});b.html(a.getForm());b.dialog("open");return!1})});