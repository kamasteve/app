function ORUpdateObject(){this.brokerList=[];this.brokerOverrideList=[]}
ORUpdateObject.prototype.getForm=function(){var a='<table id="rep-structure-update-table"><tr>';if(this.brokerOverrideList.length>0)for(var c=0;c<this.brokerOverrideList.length;c++){for(var b=0;b<this.brokerList.length;b++)if($("select[name=brokerNumber]").val()==this.brokerList[b].repNumber){a+="<td>"+this.brokerList[b].repNumber+" - "+this.brokerList[b].firstName+" "+this.brokerList[b].lastName+" Override of: </td>";break}a+='<td><input type="text" name="splitPercent" value="'+this.brokerOverrideList[c].splitPercent*
100+'" size=5 /> % on: </td>';a+='<td><select name="altRep">';for(b=0;b<this.brokerList.length;b++)$("select[name=brokerNumber]").val()!=this.brokerList[b].repNumber&&(a+=this.brokerOverrideList[c].altRep==this.brokerList[b].repNumber?'<option selected="selected" value="'+this.brokerList[b].repNumber+'">'+this.brokerList[b].repNumber+" - "+this.brokerList[b].firstName+" "+this.brokerList[b].lastName+"</option>":'<option value="'+this.brokerList[b].repNumber+'">'+this.brokerList[b].repNumber+" - "+
this.brokerList[b].firstName+" "+this.brokerList[b].lastName+"</option>");a+="</select></td>";a+='<td><button name="rep-structure-update-override" value="'+c+'">^</button></td>';a+='<td><button name="rep-structure-delete-override" value="'+c+'">-</button></td>';c==this.brokerOverrideList.length-1&&this.brokerOverrideList[c].id!=null&&(a+='<td><button name="rep-structure-add-override" value="'+c+'">+</button></td>');a+="</tr>"}else{splitPercent=" ";this.brokerOverrideList.push({id:null,mainRep:"",
altRep:""});for(b=0;b<this.brokerList.length;b++)if($("select[name=brokerNumber]").val()==this.brokerList[b].repNumber){a+="<td>"+this.brokerList[b].repNumber+" - "+this.brokerList[b].firstName+" "+this.brokerList[b].lastName+"</td>";break}a+='<td><input type="text" name="splitPercent" value="'+this.brokerOverrideList[0].splitPercent*100+'" size=5 /></td>';a+='<td><select name="altRep">';for(b=0;b<this.brokerList.length;b++)$("select[name=brokerNumber]").val()!=this.brokerList[b].repNumber&&(a+='<option value="'+
this.brokerList[b].repNumber+'">'+this.brokerList[b].repNumber+" - "+this.brokerList[b].firstName+" "+this.brokerList[b].lastName+"</option>");a+="</select></td>";a+='<td><button name="rep-structure-update-override" value="0">^</button></td></tr>'}a+="</table>";return a};ORUpdateObject.prototype.setBrokerList=function(){var a=this;dbw.table="Brokers";dbw.getByFields({active:1},function(c){a.brokerList=c})};
ORUpdateObject.prototype.setBrokerOverrideList=function(){var a=this;dbw.table="repNums";dbw.getByFields({type:"Override",mainRep:$("select[name=brokerNumber]").val()},function(c){a.brokerOverrideList=c})};ORUpdateObject.prototype.isValidPercent=function(a){return isNaN(parseFloat(a))};ORUpdateObject.prototype.simpleModalObject=function(a,c){return $("<div></div>").dialog({autoOpen:!1,buttons:{Ok:function(){$(this).dialog("close");c!=null&&c()}},height:"auto",modal:!0,title:a,width:"auto"})};
$(document).ready(function(){dbw=new DbWrapper;var a=new ORUpdateObject,c=$("<div></div>").dialog({autoOpen:!1,buttons:{Ok:function(){$(this).dialog("close");location.reload(!0)}},height:"auto",modal:!0,title:"Update Broker Structure",width:"auto"});$("#rep-structure-new-override").live("click",function(){a.method="insert";a.setBrokerList();a.setBrokerOverrideList();c.html(a.getForm());c.dialog("open");return!1});$("#rep-structure-edit-override").live("click",function(){a.method="update";a.setBrokerList();
a.setBrokerOverrideList();c.html(a.getForm());c.dialog("open");return!1});$("button[name=rep-structure-update-override]").live("click",function(){var b=$(this).val(),d={};d.mainRep=$("select[name=brokerNumber]").val();d.altRep=$("#rep-structure-update-table tr").find("select[name=altRep] option:selected").get(b).value;d.type="Override";d.splitPercent=$("#rep-structure-update-table tr").find("input[name=splitPercent]").get(b).value/100;if(a.isValidPercent(d.splitPercent))return b=a.simpleModalObject("Submission Error",
null),b.html("Please enter a valid percent."),b.dialog("open"),!1;console.dir(d);a.brokerOverrideList[b].id!=null?(d.id=a.brokerOverrideList[b].id,dbw.table="repNums",dbw.updateObject(d,function(a){console.dir(a)})):(dbw.table="repNums",dbw.insertObject(d,function(a){console.dir(a)}));a.setBrokerOverrideList();c.html(a.getForm());c.dialog("open");return!1});$("button[name=rep-structure-delete-override]").live("click",function(){var b=$(this).val();if(a.brokerOverrideList[b].id!=null)return dbw.table=
"repNums",dbw.deleteObject(a.brokerOverrideList[b].id,function(a){console.dir(a)}),a.setBrokerOverrideList(),c.html(a.getForm()),c.dialog("open"),!1});$("button[name=rep-structure-add-override]").live("click",function(){$(this).val();splitPercent=" ";a.brokerOverrideList.push({id:null,mainRep:"",altRep:""});c.html(a.getForm());c.dialog("open");return!1})});